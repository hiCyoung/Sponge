{
  "title": "mysql悲观锁总结和实践",
  "cells": [
    {
      "type": "text",
      "data": "<p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">最近学习了一下数据库的悲观锁和乐观锁，根据自己的理解和网上参考资料总结如下：</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>悲观锁介绍（百科）：</strong></p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">悲观锁，正如其名，它指的是对数据被外界（包括本系统当前的其他事务，以及来自外部系统的事务处理）修改持保守态度，因此，在整个数据处理过程中，将数据处于锁定状态。悲观锁的实现，往往依靠数据库提供的锁机制（也只有数据库层提供的锁机制才能真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系统不会修改数据）。</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>使用场景举例</strong>：以MySQL InnoDB为例</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">商品goods表中有一个字段status，status为1代表商品未被下单，status为2代表商品已经被下单，那么我们对某个商品下单时必须确保该商品status为1。假设商品的id为1。</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>1如果不采用锁，那么操作方法如下：</strong></p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//1.查询出商品信息</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">select status from t_goods where id=1;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//2.根据商品信息生成订单</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">insert into t_orders (id,goods_id) values (null,1);</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//3.修改商品status为2</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">update t_goods set status=2;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><span style=\"color: rgb(255, 0, 0);\">上面这种场景在高并发访问的情况下很可能会出现问题。</span></p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">前面已经提到，只有当goods status为1时才能对该商品下单，上面第一步操作中，查询出来的商品status为1。但是当我们执行第三步Update操作的时候，有可能出现其他人先一步对商品下单把goods status修改为2了，但是我们并不知道数据已经被修改了，这样就可能造成同一个商品被下单2次，使得数据不一致。所以说这种方式是不安全的。</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>2使用悲观锁来实现：</strong></p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">在上面的场景中，商品信息从查询出来到修改，中间有一个处理订单的过程，使用悲观锁的原理就是，当我们在查询出goods信息后就把当前的数据锁定，直到我们修改完毕后再解锁。那么在这个过程中，因为goods被锁定了，就不会出现有第三者来对其进行修改了。</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><span style=\"color: rgb(255, 0, 0);\">注：要使用悲观锁，我们必须关闭mysql数据库的自动提交属性，因为MySQL默认使用autocommit模式，也就是说，当你执行一个更新操作后，MySQL会立刻将结果进行提交。</span></p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">我们可以使用命令设置MySQL为非autocommit模式：</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">set autocommit=0;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">设置完autocommit后，我们就可以执行我们的正常业务了。具体如下：</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//0.开始事务</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">begin;/begin work;/start transaction; (三者选一就可以)</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//1.查询出商品信息</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">select status from t_goods where id=1&nbsp;<span style=\"color: rgb(255, 0, 0); background-color: rgb(255, 255, 0);\">for update</span>;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//2.根据商品信息生成订单</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">insert into t_orders (id,goods_id) values (null,1);</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//3.修改商品status为2</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">update t_goods set status=2;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">//4.提交事务</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">commit;/commit work;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><span style=\"color: rgb(255, 0, 0);\">注：上面的begin/commit为事务的开始和结束，因为在前一步我们关闭了mysql的autocommit，所以需要手动控制事务的提交，在这里就不细表了。</span></p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">上面的第一步我们执行了一次查询操作：select status from t_goods where id=1 for update;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">与普通查询不一样的是，我们使用了select…for update的方式，这样就通过数据库实现了悲观锁。此时在t_goods表中，id为1的 那条数据就被我们锁定了，其它的事务必须等本次事务提交之后才能执行。这样我们可以保证当前的数据不会被其它事务修改。</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><span style=\"color: rgb(255, 0, 0);\">注：需要注意的是，在事务中，只有SELECT ... FOR UPDATE 或LOCK IN SHARE MODE 同一笔数据时会等待其它事务结束后才执行，一般SELECT ... 则不受此影响。</span>拿上面的实例来说，当我执行select status from t_goods where id=1 for update;后。我在另外的事务中如果再次执行select status from t_goods where id=1 for update;则第二个事务会一直等待第一个事务的提交，此时第二个查询处于阻塞的状态，但是如果我是在第二个事务中执行select status from t_goods where id=1;则能正常查询出数据，不会受第一个事务的影响。</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>补充：MySQL select…for update的Row Lock与Table Lock</strong></p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">上面我们提到，使用select…for update会把数据给锁住，不过我们需要注意一些锁的级别，MySQL InnoDB默认Row-Level Lock，所以只有「明确」地指定主键，MySQL 才会执行Row lock (只锁住被选取的数据) ，否则MySQL 将会执行Table Lock (将整个数据表单给锁住)。</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong style=\"line-height: 1.5;\">举例说明：</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">数据库表t_goods，包括id,status,name三个字段，id为主键，数据库中记录如下;</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%201%20%7C%20%20%20%20%20%201%20%7C%20%E9%81%93%E5%85%B7%20%7C%0A%7C%20%202%20%7C%20%20%20%20%20%201%20%7C%20%E8%A3%85%E5%A4%87%20%7C%0A%2B----%2B--------%2B------%2B%0A2%20rows%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;道具&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;2&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;装备&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">2&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">注：为了测试数据库锁，我使用两个console来模拟不同的事务操作，分别用console1、console2来表示。&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>例1: (明确指定主键，并且有此数据，row lock)</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：查询出结果，但是把该条数据锁定了</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3D1%20for%20update%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%201%20%7C%20%20%20%20%20%201%20%7C%20%E9%81%93%E5%85%B7%20%7C%0A%2B----%2B--------%2B------%2B%0A1%20row%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id=1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;道具&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">1&nbsp;row&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询被阻塞</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3D1%20for%20update%3B\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id=1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li></ol></div><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：如果console1长时间未提交，则会报错</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3D1%20for%20update%3B%0AERROR%201205%20%3A%20Lock%20wait%20timeout%20exceeded%3B%20try%20restarting%20transaction\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id=1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">ERROR&nbsp;1205&nbsp;:&nbsp;Lock&nbsp;wait&nbsp;timeout&nbsp;exceeded;&nbsp;try&nbsp;restarting&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">transaction</span>&nbsp;&nbsp;</span></li></ol></div><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>例2: (明确指定主键，若查无此数据，无lock)</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：查询结果为空</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3D3%20for%20update%3B%0AEmpty%20set\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id=3&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Empty&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li></ol></div><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询结果为空，查询无阻塞，说明console1没有对数据执行锁定</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3D3%20for%20update%3B%0AEmpty%20set\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id=3&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Empty&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li></ol></div><p style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>例3: (无主键，table lock)</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：查询name=道具 的数据，查询正常</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20name%3D'%E9%81%93%E5%85%B7'%20for%20update%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%201%20%7C%20%20%20%20%20%201%20%7C%20%E9%81%93%E5%85%B7%20%7C%0A%2B----%2B--------%2B------%2B%0A1%20row%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>=<span class=\"string\" style=\"color: blue;\">'道具'</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;道具&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">1&nbsp;row&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询name=装备 的数据，查询阻塞，说明console1把表给锁住了</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20name%3D'%E8%A3%85%E5%A4%87'%20for%20update%3B\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>=<span class=\"string\" style=\"color: blue;\">'装备'</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：若console1长时间未提交，则查询返回为空</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20name%3D'%E8%A3%85%E5%A4%87'%20for%20update%3B%0AQuery%20OK%2C%20-1%20rows%20affected\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>=<span class=\"string\" style=\"color: blue;\">'装备'</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Query&nbsp;OK,&nbsp;-1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;affected&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>例4: (主键不明确，table lock)</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：查询正常</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20begin%3B%0AQuery%20OK%2C%200%20rows%20affected%0A%0Amysql%3E%20select%20*%20from%20t_goods%20where%20id%3E0%20for%20update%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%201%20%7C%20%20%20%20%20%201%20%7C%20%E9%81%93%E5%85%B7%20%7C%0A%7C%20%202%20%7C%20%20%20%20%20%201%20%7C%20%E8%A3%85%E5%A4%87%20%7C%0A%2B----%2B--------%2B------%2B%0A2%20rows%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">begin</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Query&nbsp;OK,&nbsp;0&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;affected&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id&gt;0&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;道具&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;2&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;装备&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">2&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询被阻塞，说明console1把表给锁住了</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3E1%20for%20update%3B\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id&gt;1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>例5: (主键不明确，table lock)</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20begin%3B%0AQuery%20OK%2C%200%20rows%20affected%0A%0Amysql%3E%20select%20*%20from%20t_goods%20where%20id%3C%3E1%20for%20update%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%202%20%7C%20%20%20%20%20%201%20%7C%20%E8%A3%85%E5%A4%87%20%7C%0A%2B----%2B--------%2B------%2B%0A1%20row%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">begin</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Query&nbsp;OK,&nbsp;0&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;affected&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id&lt;&gt;1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;2&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;装备&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">1&nbsp;row&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询被阻塞，说明console1把表给锁住了</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3C%3E2%20for%20update%3B\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id&lt;&gt;2&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：提交事务</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20commit%3B%0AQuery%20OK%2C%200%20rows%20affected\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">commit</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Query&nbsp;OK,&nbsp;0&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;affected&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：console1事务提交后，console2查询结果正常</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20id%3C%3E2%20for%20update%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%201%20%7C%20%20%20%20%20%201%20%7C%20%E9%81%93%E5%85%B7%20%7C%0A%2B----%2B--------%2B------%2B%0A1%20row%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;id&lt;&gt;2&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;道具&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">1&nbsp;row&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><span style=\"color: rgb(255, 0, 0);\">以上就是关于数据库主键对MySQL锁级别的影响实例，需要注意的是，除了主键外，使用索引也会影响数据库的锁定级别</span></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">举例：</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">我们修改t_goods表，给status字段创建一个索引</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">修改id为2的数据的status为2，此时表中数据为：</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%201%20%7C%20%20%20%20%20%201%20%7C%20%E9%81%93%E5%85%B7%20%7C%0A%7C%20%202%20%7C%20%20%20%20%20%202%20%7C%20%E8%A3%85%E5%A4%87%20%7C%0A%2B----%2B--------%2B------%2B%0A2%20rows%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;道具&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;2&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;|&nbsp;装备&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">2&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>例6: (明确指定索引，并且有此数据，row lock)</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20status%3D1%20for%20update%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%201%20%7C%20%20%20%20%20%201%20%7C%20%E9%81%93%E5%85%B7%20%7C%0A%2B----%2B--------%2B------%2B%0A1%20row%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;status=1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;1&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;|&nbsp;道具&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">1&nbsp;row&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询status=1的数据时阻塞，超时后返回为空，说明数据被console1锁定了</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20status%3D1%20for%20update%3B%0AQuery%20OK%2C%20-1%20rows%20affected\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;status=1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Query&nbsp;OK,&nbsp;-1&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">rows</span>&nbsp;affected&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询status=2的数据，能正常查询，说明console1只锁住了行，未锁表</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20status%3D2%20for%20update%3B%0A%2B----%2B--------%2B------%2B%0A%7C%20id%20%7C%20status%20%7C%20name%20%7C%0A%2B----%2B--------%2B------%2B%0A%7C%20%202%20%7C%20%20%20%20%20%202%20%7C%20%E8%A3%85%E5%A4%87%20%7C%0A%2B----%2B--------%2B------%2B%0A1%20row%20in%20set%0A%0Amysql%3E\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;status=2&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;id&nbsp;|&nbsp;status&nbsp;|&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">name</span>&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">|&nbsp;&nbsp;2&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;|&nbsp;装备&nbsp;|&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">+<span class=\"comment\" style=\"color: rgb(0, 130, 0); padding: 0px; margin: 0px; width: auto; border: 0px;\">----+--------+------+</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">1&nbsp;row&nbsp;<span class=\"op\" style=\"color: rgb(128, 128, 128);\">in</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\"><strong>例7: (明确指定索引，若查无此数据，无lock)</strong></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console1：查询status=3的数据，返回空数据</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20status%3D3%20for%20update%3B%0AEmpty%20set\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;status=3&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Empty&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">console2：查询status=3的数据，返回空数据</p><div class=\"dp-highlighter\" id=\"\" style=\"font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; background-color: rgb(255, 255, 255); width: 679px; overflow: auto; margin-left: 9px; padding: 1px; word-break: break-all; word-wrap: break-word; color: rgb(0, 0, 0); font-variant-ligatures: normal; orphans: 2; widows: 2;\"><div class=\"bar\"><div class=\"tools\" style=\"padding: 3px; margin: 0px; font-weight: bold;\">Sql代码&nbsp;<embed wmode=\"transparent\" src=\"http://chenzhou123520.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf\" width=\"14\" height=\"15\" flashvars=\"clipboard=mysql%3E%20select%20*%20from%20t_goods%20where%20status%3D3%20for%20update%3B%0AEmpty%20set\" quality=\"high\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\">&nbsp;<a title=\"收藏这段代码\" style=\"color: rgb(16, 138, 198); text-decoration: underline;\"><img class=\"star\" src=\"quiver-image-url/55EB9A99292517E853B6A4F5EF4C4E57.png\" alt=\"收藏代码\" style=\"border: 0px;\"></a></div></div><ol start=\"1\" class=\"dp-sql\" style=\"font-size: 1em; line-height: 1.4em; margin: 0px 0px 1px; padding: 2px 0px; border: 1px solid rgb(209, 215, 220); list-style-position: initial; list-style-image: initial; color: rgb(43, 145, 175);\"><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">mysql&gt;&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">select</span>&nbsp;*&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">from</span>&nbsp;t_goods&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">where</span>&nbsp;status=3&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">for</span>&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">update</span>;&nbsp;&nbsp;</span></li><li style=\"font-size: 1em; margin: 0px 0px 0px 38px; padding: 0px 0px 0px 10px; border-left: 1px solid rgb(209, 215, 220); background-color: rgb(250, 250, 250); line-height: 18px;\"><span style=\"color: black;\">Empty&nbsp;<span class=\"keyword\" style=\"color: rgb(127, 0, 85); font-weight: bold;\">set</span>&nbsp;&nbsp;</span></li></ol></div><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">以上就是关于我对数据库悲观锁的理解和总结，有不对的地方欢迎拍砖，下一次会带来<a href=\"http://chenzhou123520.iteye.com/blog/1863407\" target=\"_blank\" style=\"color: rgb(16, 138, 198);\">数据库乐观锁的总结和实践</a></p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">&nbsp;</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">参考资料：</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">MySQL事务与锁定命令：http://www.docin.com/p-16805970.html</p><p class=\"MsoNormal\" style=\"margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255);\">悲观锁：http://www.cnblogs.com/chenwenbiao/archive/2012/06/06/2537508.html&nbsp;</p>"
    }
  ]
}